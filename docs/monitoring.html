

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Monitoring &amp; Observability &mdash; HemoStat Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=01f34227"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Protocol" href="api_protocol.html" />
    <link rel="prev" title="System Architecture" href="architecture.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            HemoStat
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">System Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Monitoring &amp; Observability</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#architecture">Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#metrics-exporter-agent">Metrics Exporter Agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-flow">Data Flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#metrics-catalog">Metrics Catalog</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#container-health-metrics">Container Health Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#health-alert-metrics">Health Alert Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-metrics">Analysis Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remediation-metrics">Remediation Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alert-metrics">Alert Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-metrics">System Metrics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start-monitoring-stack">1. Start Monitoring Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#access-dashboards">2. Access Dashboards</a></li>
<li class="toctree-l3"><a class="reference internal" href="#view-hemostat-overview-dashboard">3. View HemoStat Overview Dashboard</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#prometheus-configuration">Prometheus Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scrape-configuration">Scrape Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alert-rules">Alert Rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#grafana-dashboards">Grafana Dashboards</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hemostat-overview-dashboard">HemoStat Overview Dashboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="#auto-provisioning">Auto-Provisioning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#promql-query-examples">PromQL Query Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#container-metrics">Container Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-performance">Analysis Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remediation-tracking">Remediation Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-health">System Health</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-scrape-intervals">Customizing Scrape Intervals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adjusting-alert-thresholds">Adjusting Alert Thresholds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#changing-data-retention">Changing Data Retention</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#metrics-not-appearing">Metrics Not Appearing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prometheus-not-scraping">Prometheus Not Scraping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#grafana-shows-no-data">Grafana Shows “No Data”</a></li>
<li class="toctree-l3"><a class="reference internal" href="#high-resource-usage">High Resource Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#integration-with-existing-dashboard">Integration with Existing Dashboard</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#streamlit-dashboard-port-8501">Streamlit Dashboard (Port 8501)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#grafana-dashboard-port-3000">Grafana Dashboard (Port 3000)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dashboard-design">Dashboard Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alerting-strategy">Alerting Strategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-optimization">Performance Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#security">Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-topics">Advanced Topics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-custom-metrics">Adding Custom Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-dashboards">Creating Custom Dashboards</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-alertmanager">Setting Up Alertmanager</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remote-write-configuration">Remote Write Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#service-urls">Service URLs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_protocol.html">API Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html#base-classes">Base Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HemoStat</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Monitoring &amp; Observability</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/monitoring.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="monitoring-observability">
<h1>Monitoring &amp; Observability<a class="headerlink" href="#monitoring-observability" title="Link to this heading"></a></h1>
<p>HemoStat includes a comprehensive monitoring stack built on Prometheus and Grafana, providing deep insights into system performance, container health, and agent operations.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The monitoring stack consists of three key components:</p>
<ol class="arabic simple">
<li><p><strong>Metrics Exporter Agent</strong> - Subscribes to HemoStat events and exposes Prometheus metrics</p></li>
<li><p><strong>Prometheus</strong> - Time-series database for metrics collection and alerting</p></li>
<li><p><strong>Grafana</strong> - Visualization dashboards for historical analysis</p></li>
</ol>
<pre  class="mermaid">
        graph LR
    A[Monitor Agent] --&gt;|events| R[Redis]
    B[Analyzer Agent] --&gt;|events| R
    C[Responder Agent] --&gt;|events| R
    D[Alert Agent] --&gt;|events| R
    R --&gt;|subscribe| M[Metrics Exporter]
    M --&gt;|:9090/metrics| P[Prometheus]
    P --&gt;|data source| G[Grafana Dashboards]
    </pre></section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading"></a></h2>
<section id="metrics-exporter-agent">
<h3>Metrics Exporter Agent<a class="headerlink" href="#metrics-exporter-agent" title="Link to this heading"></a></h3>
<p>The Metrics Exporter is a specialized HemoStat agent that:</p>
<ul class="simple">
<li><p>Subscribes to all HemoStat Redis pub/sub channels</p></li>
<li><p>Converts events into Prometheus-compatible metrics</p></li>
<li><p>Exposes an HTTP endpoint at <code class="docutils literal notranslate"><span class="pre">http://localhost:9090/metrics</span></code></p></li>
<li><p>Tracks container health, agent performance, and system operations</p></li>
</ul>
<p><strong>Implementation</strong>: <code class="docutils literal notranslate"><span class="pre">agents/hemostat_metrics/metrics.py</span></code></p>
</section>
<section id="data-flow">
<h3>Data Flow<a class="headerlink" href="#data-flow" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>HemoStat agents publish events to Redis</p></li>
<li><p>Metrics Exporter subscribes and converts events to metrics</p></li>
<li><p>Prometheus scrapes metrics endpoint every 10 seconds</p></li>
<li><p>Grafana queries Prometheus for visualization</p></li>
<li><p>Alert rules trigger notifications on anomalies</p></li>
</ol>
</section>
</section>
<section id="metrics-catalog">
<h2>Metrics Catalog<a class="headerlink" href="#metrics-catalog" title="Link to this heading"></a></h2>
<section id="container-health-metrics">
<h3>Container Health Metrics<a class="headerlink" href="#container-health-metrics" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_container_cpu_percent</span></code></p></td>
<td><p>Gauge</p></td>
<td><p>CPU usage percentage per container</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_container_memory_percent</span></code></p></td>
<td><p>Gauge</p></td>
<td><p>Memory usage percentage per container</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_container_memory_bytes</span></code></p></td>
<td><p>Gauge</p></td>
<td><p>Memory usage in bytes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_container_restart_count</span></code></p></td>
<td><p>Gauge</p></td>
<td><p>Container restart count</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_container_network_rx_bytes_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Network bytes received</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_container_network_tx_bytes_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Network bytes transmitted</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_container_blkio_read_bytes_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Block I/O read bytes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_container_blkio_write_bytes_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Block I/O write bytes</p></td>
</tr>
</tbody>
</table>
</section>
<section id="health-alert-metrics">
<h3>Health Alert Metrics<a class="headerlink" href="#health-alert-metrics" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_health_alerts_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Total health alerts by severity</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_anomalies_detected_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Total anomalies by type</p></td>
</tr>
</tbody>
</table>
</section>
<section id="analysis-metrics">
<h3>Analysis Metrics<a class="headerlink" href="#analysis-metrics" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_analysis_requests_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Total analysis requests by result type</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_analysis_duration_seconds</span></code></p></td>
<td><p>Histogram</p></td>
<td><p>Analysis response time distribution</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_analysis_confidence</span></code></p></td>
<td><p>Histogram</p></td>
<td><p>AI confidence score distribution</p></td>
</tr>
</tbody>
</table>
</section>
<section id="remediation-metrics">
<h3>Remediation Metrics<a class="headerlink" href="#remediation-metrics" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_remediation_attempts_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Total attempts by action and status</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_remediation_duration_seconds</span></code></p></td>
<td><p>Histogram</p></td>
<td><p>Remediation execution time</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_remediation_cooldown_active</span></code></p></td>
<td><p>Gauge</p></td>
<td><p>Cooldown status per container</p></td>
</tr>
</tbody>
</table>
</section>
<section id="alert-metrics">
<h3>Alert Metrics<a class="headerlink" href="#alert-metrics" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_alerts_sent_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Total alerts sent by channel and status</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_alerts_deduped_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Total deduplicated alerts</p></td>
</tr>
</tbody>
</table>
</section>
<section id="system-metrics">
<h3>System Metrics<a class="headerlink" href="#system-metrics" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_agent_uptime_seconds</span></code></p></td>
<td><p>Gauge</p></td>
<td><p>Agent uptime tracking</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_redis_operations_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Redis operations by type</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_time_to_detection_seconds</span></code></p></td>
<td><p>Histogram</p></td>
<td><p>Time from issue to detection</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hemostat_time_to_remediation_seconds</span></code></p></td>
<td><p>Histogram</p></td>
<td><p>Time from detection to fix</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading"></a></h2>
<section id="start-monitoring-stack">
<h3>1. Start Monitoring Stack<a class="headerlink" href="#start-monitoring-stack" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start all services including monitoring</span>
docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d

<span class="c1"># Or start just monitoring components</span>
docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>redis<span class="w"> </span>metrics<span class="w"> </span>prometheus<span class="w"> </span>grafana
</pre></div>
</div>
</section>
<section id="access-dashboards">
<h3>2. Access Dashboards<a class="headerlink" href="#access-dashboards" title="Link to this heading"></a></h3>
<p><strong>Grafana Dashboard</strong></p>
<ul class="simple">
<li><p>URL: http://localhost:3000</p></li>
<li><p>Username: <code class="docutils literal notranslate"><span class="pre">admin</span></code></p></li>
<li><p>Password: <code class="docutils literal notranslate"><span class="pre">admin</span></code> (change on first login)</p></li>
</ul>
<p><strong>Prometheus Query UI</strong></p>
<ul class="simple">
<li><p>URL: http://localhost:9091</p></li>
<li><p>Direct metric queries and exploration</p></li>
</ul>
<p><strong>Metrics Endpoint</strong></p>
<ul class="simple">
<li><p>URL: http://localhost:9090/metrics</p></li>
<li><p>Raw Prometheus metrics</p></li>
</ul>
</section>
<section id="view-hemostat-overview-dashboard">
<h3>3. View HemoStat Overview Dashboard<a class="headerlink" href="#view-hemostat-overview-dashboard" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Login to Grafana</p></li>
<li><p>Navigate to <strong>Dashboards</strong> → <strong>HemoStat</strong> folder</p></li>
<li><p>Select <strong>HemoStat Overview</strong></p></li>
</ol>
<p>The dashboard displays:</p>
<ul class="simple">
<li><p>Container CPU and memory usage graphs</p></li>
<li><p>Health alerts by severity</p></li>
<li><p>Analysis performance metrics (response time, confidence)</p></li>
<li><p>Remediation attempts and success rates</p></li>
<li><p>Agent uptime and system health</p></li>
</ul>
</section>
</section>
<section id="prometheus-configuration">
<h2>Prometheus Configuration<a class="headerlink" href="#prometheus-configuration" title="Link to this heading"></a></h2>
<section id="scrape-configuration">
<h3>Scrape Configuration<a class="headerlink" href="#scrape-configuration" title="Link to this heading"></a></h3>
<p>Prometheus is configured to scrape the Metrics Exporter every 10 seconds:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">scrape_configs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;hemostat-metrics&#39;</span>
<span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;metrics:9090&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">    </span><span class="nt">scrape_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</pre></div>
</div>
<p><strong>Configuration file</strong>: <code class="docutils literal notranslate"><span class="pre">monitoring/prometheus/prometheus.yml</span></code></p>
</section>
<section id="alert-rules">
<h3>Alert Rules<a class="headerlink" href="#alert-rules" title="Link to this heading"></a></h3>
<p>Pre-configured alert rules monitor system health:</p>
<p><strong>Container Health Alerts</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HighContainerCPU</span></code> - CPU &gt; 90% for 2+ minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HighContainerMemory</span></code> - Memory &gt; 90% for 2+ minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ExcessiveContainerRestarts</span></code> - Frequent restart rate</p></li>
</ul>
<p><strong>System Performance Alerts</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SlowAnalysisResponse</span></code> - p95 latency &gt; 10 seconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HighRemediationFailureRate</span></code> - Failure rate &gt; 30%</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HighAlertFailureRate</span></code> - Notification failures &gt; 20%</p></li>
</ul>
<p><strong>System Health Alerts</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MetricsExporterDown</span></code> - Exporter unavailable for 1+ minute</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NoHealthAlertsDetected</span></code> - No alerts for 30+ minutes (possible monitor issue)</p></li>
</ul>
<p><strong>Configuration file</strong>: <code class="docutils literal notranslate"><span class="pre">monitoring/prometheus/rules/hemostat_alerts.yml</span></code></p>
</section>
</section>
<section id="grafana-dashboards">
<h2>Grafana Dashboards<a class="headerlink" href="#grafana-dashboards" title="Link to this heading"></a></h2>
<section id="hemostat-overview-dashboard">
<h3>HemoStat Overview Dashboard<a class="headerlink" href="#hemostat-overview-dashboard" title="Link to this heading"></a></h3>
<p>The main dashboard provides 11 panels across four sections:</p>
<p><strong>Summary Metrics</strong></p>
<ul class="simple">
<li><p>Monitored containers count</p></li>
<li><p>Health alerts per minute</p></li>
<li><p>Median analysis confidence</p></li>
<li><p>Remediations per minute</p></li>
</ul>
<p><strong>Container Health Graphs</strong></p>
<ul class="simple">
<li><p>CPU usage time-series per container</p></li>
<li><p>Memory usage time-series per container</p></li>
</ul>
<p><strong>System Activity</strong></p>
<ul class="simple">
<li><p>Health alerts by severity</p></li>
<li><p>Analysis requests by result type</p></li>
<li><p>Remediation attempts by action and status</p></li>
</ul>
<p><strong>Performance Metrics</strong></p>
<ul class="simple">
<li><p>Analysis duration percentiles (p50, p95, p99)</p></li>
<li><p>Remediation duration percentiles (p50, p95, p99)</p></li>
</ul>
</section>
<section id="auto-provisioning">
<h3>Auto-Provisioning<a class="headerlink" href="#auto-provisioning" title="Link to this heading"></a></h3>
<p>Dashboards and data sources are automatically configured on startup:</p>
<ul class="simple">
<li><p><strong>Data Source</strong>: <code class="docutils literal notranslate"><span class="pre">monitoring/grafana/provisioning/datasources/prometheus.yml</span></code></p></li>
<li><p><strong>Dashboard</strong>: <code class="docutils literal notranslate"><span class="pre">monitoring/grafana/provisioning/dashboards/hemostat_overview.json</span></code></p></li>
</ul>
</section>
</section>
<section id="promql-query-examples">
<h2>PromQL Query Examples<a class="headerlink" href="#promql-query-examples" title="Link to this heading"></a></h2>
<section id="container-metrics">
<h3>Container Metrics<a class="headerlink" href="#container-metrics" title="Link to this heading"></a></h3>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Average CPU across all containers</span>
<span class="k">avg</span><span class="o">(</span><span class="nv">hemostat_container_cpu_percent</span><span class="o">)</span>

<span class="c1"># Containers with high memory usage</span>
<span class="nv">hemostat_container_memory_percent</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">80</span>

<span class="c1"># Container restart rate</span>
<span class="kr">rate</span><span class="o">(</span><span class="nv">hemostat_container_restart_count</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</pre></div>
</div>
</section>
<section id="analysis-performance">
<h3>Analysis Performance<a class="headerlink" href="#analysis-performance" title="Link to this heading"></a></h3>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analysis p95 latency</span>
<span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.95</span><span class="p">,</span><span class="w"> </span><span class="kr">rate</span><span class="o">(</span><span class="nv">hemostat_analysis_duration_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span>

<span class="c1"># Median confidence score</span>
<span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="kr">rate</span><span class="o">(</span><span class="nv">hemostat_analysis_confidence_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span>

<span class="c1"># Analysis requests per second</span>
<span class="kr">rate</span><span class="o">(</span><span class="nv">hemostat_analysis_requests_total</span><span class="p">[</span><span class="s">1m</span><span class="p">]</span><span class="o">)</span>
</pre></div>
</div>
</section>
<section id="remediation-tracking">
<h3>Remediation Tracking<a class="headerlink" href="#remediation-tracking" title="Link to this heading"></a></h3>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remediation success rate</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">hemostat_remediation_attempts_total</span><span class="p">{</span><span class="nl">status</span><span class="o">=</span><span class="p">&quot;</span><span class="s">success</span><span class="p">&quot;}[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="o">/</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">hemostat_remediation_attempts_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span>

<span class="c1"># Failed remediations per minute</span>
<span class="kr">rate</span><span class="o">(</span><span class="nv">hemostat_remediation_attempts_total</span><span class="p">{</span><span class="nl">status</span><span class="o">=</span><span class="p">&quot;</span><span class="s">failed</span><span class="p">&quot;}[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span>

<span class="c1"># Remediation duration p99</span>
<span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.99</span><span class="p">,</span><span class="w"> </span><span class="kr">rate</span><span class="o">(</span><span class="nv">hemostat_remediation_duration_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span>
</pre></div>
</div>
</section>
<section id="system-health">
<h3>System Health<a class="headerlink" href="#system-health" title="Link to this heading"></a></h3>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Agent uptime</span>
<span class="nv">hemostat_agent_uptime_seconds</span><span class="p">{</span><span class="nl">agent_name</span><span class="o">=</span><span class="p">&quot;</span><span class="s">metrics</span><span class="p">&quot;}</span>

<span class="c1"># Total health alerts in last hour</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">increase</span><span class="o">(</span><span class="nv">hemostat_health_alerts_total</span><span class="p">[</span><span class="s">1h</span><span class="p">]</span><span class="o">))</span>

<span class="c1"># Alert deduplication rate</span>
<span class="kr">rate</span><span class="o">(</span><span class="nv">hemostat_alerts_deduped_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</pre></div>
</div>
</section>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<section id="environment-variables">
<h3>Environment Variables<a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h3>
<p><strong>Metrics Exporter</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">METRICS_PORT</span><span class="o">=</span><span class="m">9090</span><span class="w">          </span><span class="c1"># HTTP server port</span>
<span class="nv">REDIS_HOST</span><span class="o">=</span>redis<span class="w">           </span><span class="c1"># Redis hostname</span>
<span class="nv">REDIS_PORT</span><span class="o">=</span><span class="m">6379</span><span class="w">           </span><span class="c1"># Redis port</span>
<span class="nv">LOG_LEVEL</span><span class="o">=</span>INFO<span class="w">            </span><span class="c1"># Logging level</span>
</pre></div>
</div>
<p><strong>Prometheus</strong></p>
<ul class="simple">
<li><p>Data retention: 15 days (configurable via <code class="docutils literal notranslate"><span class="pre">--storage.tsdb.retention.time</span></code>)</p></li>
<li><p>Scrape interval: 10 seconds (configurable in <code class="docutils literal notranslate"><span class="pre">prometheus.yml</span></code>)</p></li>
</ul>
<p><strong>Grafana</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">GF_SECURITY_ADMIN_USER</span><span class="o">=</span>admin<span class="w">           </span><span class="c1"># Admin username</span>
<span class="nv">GF_SECURITY_ADMIN_PASSWORD</span><span class="o">=</span>admin<span class="w">       </span><span class="c1"># Admin password (change this!)</span>
<span class="nv">GF_USERS_ALLOW_SIGN_UP</span><span class="o">=</span><span class="nb">false</span><span class="w">          </span><span class="c1"># Disable user signup</span>
</pre></div>
</div>
</section>
<section id="customizing-scrape-intervals">
<h3>Customizing Scrape Intervals<a class="headerlink" href="#customizing-scrape-intervals" title="Link to this heading"></a></h3>
<p>Edit <code class="docutils literal notranslate"><span class="pre">monitoring/prometheus/prometheus.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">scrape_configs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;hemostat-metrics&#39;</span>
<span class="w">    </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span><span class="w">  </span><span class="c1"># More frequent scraping</span>
</pre></div>
</div>
</section>
<section id="adjusting-alert-thresholds">
<h3>Adjusting Alert Thresholds<a class="headerlink" href="#adjusting-alert-thresholds" title="Link to this heading"></a></h3>
<p>Edit <code class="docutils literal notranslate"><span class="pre">monitoring/prometheus/rules/hemostat_alerts.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighContainerCPU</span>
<span class="w">  </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hemostat_container_cpu_percent &gt; 95</span><span class="w">  </span><span class="c1"># Increase threshold</span>
<span class="w">  </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span><span class="w">  </span><span class="c1"># Wait longer before alerting</span>
</pre></div>
</div>
</section>
<section id="changing-data-retention">
<h3>Changing Data Retention<a class="headerlink" href="#changing-data-retention" title="Link to this heading"></a></h3>
<p>Edit <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">prometheus</span><span class="p">:</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.retention.time=30d&#39;</span><span class="w">  </span><span class="c1"># Keep data for 30 days</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.retention.size=10GB&#39;</span><span class="w"> </span><span class="c1"># Limit storage size</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="metrics-not-appearing">
<h3>Metrics Not Appearing<a class="headerlink" href="#metrics-not-appearing" title="Link to this heading"></a></h3>
<p><strong>Check Metrics Exporter</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># View logs</span>
docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>metrics

<span class="c1"># Verify endpoint is accessible</span>
curl<span class="w"> </span>http://localhost:9090/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>hemostat_

<span class="c1"># Check Redis connection</span>
docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>metrics<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import redis; redis.Redis(host=&#39;redis&#39;).ping()&quot;</span>
</pre></div>
</div>
</section>
<section id="prometheus-not-scraping">
<h3>Prometheus Not Scraping<a class="headerlink" href="#prometheus-not-scraping" title="Link to this heading"></a></h3>
<p><strong>Verify Targets</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check target status</span>
curl<span class="w"> </span>http://localhost:9091/api/v1/targets

<span class="c1"># View in browser</span>
open<span class="w"> </span>http://localhost:9091/targets
</pre></div>
</div>
<p><strong>Check Connectivity</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test from Prometheus container</span>
docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>prometheus<span class="w"> </span>wget<span class="w"> </span>-O-<span class="w"> </span>http://metrics:9090/metrics
</pre></div>
</div>
</section>
<section id="grafana-shows-no-data">
<h3>Grafana Shows “No Data”<a class="headerlink" href="#grafana-shows-no-data" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Verify time range</strong> - Use “Last 15 minutes” or “Last 1 hour”</p></li>
<li><p><strong>Test data source</strong> - Go to Configuration → Data Sources → Test</p></li>
<li><p><strong>Check Prometheus</strong> - Query metrics directly in Prometheus UI</p></li>
<li><p><strong>Generate activity</strong> - Start agents to create events</p></li>
</ol>
<p><strong>Test Prometheus Connection</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># From Grafana container</span>
docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>grafana<span class="w"> </span>wget<span class="w"> </span>-O-<span class="w"> </span>http://prometheus:9090/api/v1/query?query<span class="o">=</span>up
</pre></div>
</div>
</section>
<section id="high-resource-usage">
<h3>High Resource Usage<a class="headerlink" href="#high-resource-usage" title="Link to this heading"></a></h3>
<p><strong>Reduce Scrape Frequency</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span><span class="w">  </span><span class="c1"># From 10s to 30s</span>
</pre></div>
</div>
<p><strong>Lower Retention Period</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">--storage.tsdb.retention.time=7d</span><span class="w">  </span><span class="c1"># From 15d to 7d</span>
</pre></div>
</div>
<p><strong>Add Recording Rules</strong> for expensive queries:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create recording rules for frequently used queries</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">record</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">job:hemostat_cpu_avg:5m</span>
<span class="w">  </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">avg(hemostat_container_cpu_percent)</span>
</pre></div>
</div>
</section>
</section>
<section id="integration-with-existing-dashboard">
<h2>Integration with Existing Dashboard<a class="headerlink" href="#integration-with-existing-dashboard" title="Link to this heading"></a></h2>
<p>HemoStat provides two complementary dashboards:</p>
<section id="streamlit-dashboard-port-8501">
<h3>Streamlit Dashboard (Port 8501)<a class="headerlink" href="#streamlit-dashboard-port-8501" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Real-time event streaming</strong></p></li>
<li><p><strong>Live container status grid</strong></p></li>
<li><p><strong>Event timeline and details</strong></p></li>
<li><p><strong>Active issues feed</strong></p></li>
</ul>
</section>
<section id="grafana-dashboard-port-3000">
<h3>Grafana Dashboard (Port 3000)<a class="headerlink" href="#grafana-dashboard-port-3000" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Historical metrics analysis</strong></p></li>
<li><p><strong>Performance trends over time</strong></p></li>
<li><p><strong>Alert visualization</strong></p></li>
<li><p><strong>Custom query exploration</strong></p></li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul class="simple">
<li><p><strong>Streamlit</strong>: Real-time incident response and live monitoring</p></li>
<li><p><strong>Grafana</strong>: Performance analysis, capacity planning, trend identification</p></li>
</ul>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h2>
<section id="dashboard-design">
<h3>Dashboard Design<a class="headerlink" href="#dashboard-design" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Use appropriate time ranges</strong> - Last 1 hour for real-time, 24 hours for trends</p></li>
<li><p><strong>Set meaningful thresholds</strong> - Based on SLAs and baseline performance</p></li>
<li><p><strong>Add annotations</strong> - Mark deployments and incidents on graphs</p></li>
<li><p><strong>Create variables</strong> - For dynamic container/service filtering</p></li>
</ol>
</section>
<section id="alerting-strategy">
<h3>Alerting Strategy<a class="headerlink" href="#alerting-strategy" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Set alert thresholds conservatively</strong> - Avoid alert fatigue</p></li>
<li><p><strong>Use multi-condition alerts</strong> - Combine metrics for context</p></li>
<li><p><strong>Configure notification channels</strong> - Slack, email, PagerDuty</p></li>
<li><p><strong>Test alert rules</strong> - Verify alerts trigger appropriately</p></li>
</ol>
</section>
<section id="performance-optimization">
<h3>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Use recording rules</strong> - Pre-compute expensive queries</p></li>
<li><p><strong>Limit cardinality</strong> - Avoid high-cardinality labels</p></li>
<li><p><strong>Set appropriate retention</strong> - Balance storage and query needs</p></li>
<li><p><strong>Monitor Prometheus itself</strong> - Track ingestion rate and query performance</p></li>
</ol>
</section>
<section id="security">
<h3>Security<a class="headerlink" href="#security" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Change default passwords</strong> - Especially Grafana admin password</p></li>
<li><p><strong>Enable authentication</strong> - For Prometheus and Grafana</p></li>
<li><p><strong>Use HTTPS</strong> - In production deployments</p></li>
<li><p><strong>Restrict network access</strong> - Limit to authorized networks</p></li>
</ol>
</section>
</section>
<section id="advanced-topics">
<h2>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Link to this heading"></a></h2>
<section id="adding-custom-metrics">
<h3>Adding Custom Metrics<a class="headerlink" href="#adding-custom-metrics" title="Link to this heading"></a></h3>
<p>Extend the Metrics Exporter in <code class="docutils literal notranslate"><span class="pre">agents/hemostat_metrics/metrics.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">prometheus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>

<span class="c1"># Define new metric</span>
<span class="bp">self</span><span class="o">.</span><span class="n">custom_metric</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
    <span class="s2">&quot;hemostat_custom_total&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Description of custom metric&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;label1&quot;</span><span class="p">,</span> <span class="s2">&quot;label2&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Update metric in event handler</span>
<span class="bp">self</span><span class="o">.</span><span class="n">custom_metric</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="n">label1</span><span class="o">=</span><span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="n">label2</span><span class="o">=</span><span class="s2">&quot;value2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">inc</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="creating-custom-dashboards">
<h3>Creating Custom Dashboards<a class="headerlink" href="#creating-custom-dashboards" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Design dashboard in Grafana UI</p></li>
<li><p>Export as JSON: Dashboard Settings → JSON Model</p></li>
<li><p>Save to <code class="docutils literal notranslate"><span class="pre">monitoring/grafana/provisioning/dashboards/</span></code></p></li>
<li><p>Restart Grafana to load</p></li>
</ol>
</section>
<section id="setting-up-alertmanager">
<h3>Setting Up Alertmanager<a class="headerlink" href="#setting-up-alertmanager" title="Link to this heading"></a></h3>
<p>For advanced alert routing and aggregation:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># In prometheus.yml</span>
<span class="nt">alerting</span><span class="p">:</span>
<span class="w">  </span><span class="nt">alertmanagers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">static_configs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;alertmanager:9093&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
<section id="remote-write-configuration">
<h3>Remote Write Configuration<a class="headerlink" href="#remote-write-configuration" title="Link to this heading"></a></h3>
<p>For long-term storage:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># In prometheus.yml</span>
<span class="nt">remote_write</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://prometheus-remote-storage.example.com/api/v1/write&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="service-urls">
<h2>Service URLs<a class="headerlink" href="#service-urls" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Service</p></th>
<th class="head"><p>URL</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Grafana</strong></p></td>
<td><p>http://localhost:3000</p></td>
<td><p>Visualization dashboards</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Prometheus</strong></p></td>
<td><p>http://localhost:9091</p></td>
<td><p>Query UI and alerts</p></td>
</tr>
<tr class="row-even"><td><p><strong>Metrics Exporter</strong></p></td>
<td><p>http://localhost:9090/metrics</p></td>
<td><p>Raw metrics endpoint</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Streamlit Dashboard</strong></p></td>
<td><p>http://localhost:8501</p></td>
<td><p>Real-time monitoring</p></td>
</tr>
</tbody>
</table>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Prometheus Documentation</strong>: https://prometheus.io/docs/</p></li>
<li><p><strong>Grafana Documentation</strong>: https://grafana.com/docs/</p></li>
<li><p><strong>PromQL Guide</strong>: https://prometheus.io/docs/prometheus/latest/querying/basics/</p></li>
<li><p><strong>Metrics Exporter Source</strong>: <code class="docutils literal notranslate"><span class="pre">agents/hemostat_metrics/</span></code></p></li>
<li><p><strong>Configuration Files</strong>: <code class="docutils literal notranslate"><span class="pre">monitoring/prometheus/</span></code> and <code class="docutils literal notranslate"><span class="pre">monitoring/grafana/</span></code></p></li>
</ul>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="architecture.html"><span class="std std-doc">Architecture</span></a> - System design and agent communication</p></li>
<li><p><a class="reference internal" href="deployment.html"><span class="std std-doc">Deployment</span></a> - Production deployment strategies</p></li>
<li><p><a class="reference internal" href="troubleshooting.html"><span class="std std-doc">Troubleshooting</span></a> - Common issues and solutions</p></li>
<li><p><a class="reference internal" href="api/agents.html"><span class="std std-doc">API Reference</span></a> - Metrics Exporter API documentation</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="architecture.html" class="btn btn-neutral float-left" title="System Architecture" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api_protocol.html" class="btn btn-neutral float-right" title="API Protocol" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, The HemoStat Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>